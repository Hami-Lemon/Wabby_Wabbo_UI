<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta http-equiv="X-UA-Compatible" content="ie=edge">
		<link href="css/mdui.min.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="css/navigation.css" />
		<script src="js/mdui.min.js"></script>
		<script src="js/iconfont.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/vue.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/communicate.js" type="text/javascript" charset="utf-8"></script>
		<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
		<title>帖子详情</title>
		<style>
			* {
				margin: 0;
				padding: 0;
			}

			body {
				background-color: #fffef9;
			}

			/* 点赞图标（svg格式） */
			.icon {
				width: 1em;
				height: 1em;
				vertical-align: -0.15em;
				fill: currentColor;
				overflow: hidden;
			}

			#zan:hover {
				cursor: pointer;
			}

			/* 帖子文本内容 */
			.container {
				width: 660px;
				margin: 0 auto;
			}

			.page-container {
				margin-top: 80px;
				margin-bottom: 30px;
				font-size: 18px;
				line-height: 1.8;
				width: 100%;
				overflow-y: initial;
				padding: 5%;
			}

			.page-action i {
				border: 2px solid #000000;
				border-radius: 12px;
				padding: 5px;
				font-size: 12px;
				background-color: #ede3e7;
			}

			.page-action {
				margin-bottom: 10px;
				margin-top: 10px;
				display: inline;
				position: relative;
				left: 82%;
			}

			.type-label {
				display: inline;
				font-size: 12px;
				border: 2px solid #000000;
				border-radius: 12px;
				padding: 5px;
				font-weight: bold;
				position: relative;
				left: 2%;
			}

			/* 分隔线 */
			hr {
				margin: 18px 0;
				clear: both;
			}

			#hot_comments .time {
				position: absolute;
				left: 36%;
				font-size: 8px;
			}

			#comments .time {
				position: absolute;
				left: 66%;
				top: 60%;
				font-size: 8px;
			}

			/* 热门评论 */
			.hot-comments div {
				float: left;
				border: 2px solid #616161;
				border-radius: 12px;
				width: 180px;
				padding: 4px 4px 20px 4px;
				position: relative;
				margin-bottom: 18px;
				/* margin-right: 0px; */
				line-height: 20px;
				margin-left: 30px;
				background-color: #e6d2d5;
			}

			/* 普通评论 */
			.comment {
				clear: both;
				border: 2px solid #616161;
				border-radius: 12px;
				padding: 4px 4px 10px 4px;
				margin-bottom: 28px;
				position: relative;
			}

			.comments i {
				border: 0px solid #000000;
				border-radius: 12px;
				background-color: #ede3e7;
				padding: 5px;
				font-size: 12px;
			}

			.comment-action {
				position: relative;
				left: 90%;
				bottom: 10%;
			}

			#com {
				list-style: none;
			}
		</style>
	</head>
	<body>
		<div class="mdui-container">
			<header class="mdui-container-fluid">
				<div class="title-logo">Wabby Wabbo</div>
				<!-- 搜索框 -->
				<div class="serch mdui-row">
					<input type="text" class="mdui-col-xs-10 serch-input" placeholder="搜索" />
					<div class="iconfont mdui-col-xs-2">&#xe605;</div>
				</div>
			</header>
			<div class="container">
				<!-- 展示文本的区域 -->
				<div id="message">
					<div class="page-container mdui-card">
						<p>{{tip.content}}</p>
					</div>
					<div class="mdui-row">
						<div class="type-label">
							<span>{{tip.type}}</span>
						</div>
						<div class="page-action">
							<svg class="icon" aria-hidden="true" id="zan">
								<use xlink:href="#icon-dianzan"></use>
							</svg>
							<i>赞 {{tip.starNum}}</i>
						</div>
					</div>
				</div>
				<hr />
				<div class="hot-comments" id="hot_comments">
					<template v-for="hotcomment in hotcomments">
						<div class="mdui-card">
							<p>{{hotcomment.content}}</p>
							<i class="time">{{hotcomment.date}}</i>
						</div>
					</template>
				</div>
				<hr />
				<div class="comments" id="comments">
					<ul>
						<li id="com" v-for="comment in comments">
							<div class="comment mdui-card">
								<div class="comment-content">
									<p>{{comment.content}}</p>
								</div>
								<div class="time">{{comment.date}}</div>
								<div class="comment-action">
									<svg class="icon" aria-hidden="true">
										<use xlink:href="#icon-dianzan"></use>
									</svg>
									<i>赞 {{comment.starNum}}</i>
								</div>
							</div>
						</li>
					</ul>
				</div>
			</div>
		</div>
	</body>
	<script type="text/javascript">
		/*获取url参数*/
		var url = window.location.search;
		var str = url.split("=");
		var tips_id = str[1];
		/*根据id获取帖子详细内容*/
		var message = new Vue({
			el: "#message",
			data: {
				tip: {
					id: 0,
					content: "未获取到数据，请检查网络是否正常"
				},
			},
			methods: {
				getTipById: function() {
					getTipsById(tips_id, function(data) {
						let errorTips = {
							id: 0,
							content: ""
						}
						if (data.code != 200) {
							/* 获取失败*/
							// alert(data.msg);
							errorTips.content = "获取失败，请检查网络设置";
							message.tip = errorTips;
							return;
						} else if (data.data == null) {
							/* 数据为空*/
							errorTips.content = "未获取到数据";
							message.tip = errorTips;
							return;
						}

						var Mytip = data.data[0];
						message.tip = Mytip;
					})
				}
			}
		})
		message.getTipById();
		/*获取热评*/
		var hot_comments = new Vue({
			el: "#hot_comments",
			data: {
				hotcomments: [{
					id: 0,
					content: "未获取到数据，请检查网络是否正常"
				}]
			},
			methods: {
				getHotComments: function() {
					getHotComments(tips_id, function(data) {
						let errorTips = {
							id: 0,
							content: ""
						}
						if (data.code != 200) {
							/* 获取失败*/
							// alert(data.msg);
							errorTips.content = "获取失败，请检查网络设置";
							hot_comments.hotcomments.push(errorTips);
							return;
						} else if (data.data == null) {
							/* 数据为空*/
							errorTips.content = "未获取到数据";
							hot_comments.hotcomments.push(errorTips);
							return;
						}
						
						var hotComments = data.data;
						hot_comments.hotcomments.push(hotComments);
					})
				}
			}
		})
		hot_comments.getHotComments();
		/*获取评论*/
		var comments = new Vue({
			el: "#comments",
			data: {
				comments: [{
					id: 0,
					content: "未获取到数据，请检查网络是否正常"
				}]
			},
			methods: {
				getComments: function() {
					getComments(tips_id,1,function(data) {
						console.log(data);
						let errorTips = {
							id: 0,
							content: ""
						}
						if (data.code != 200) {
							/* 获取失败*/
							// alert(data.msg);
							errorTips.content = "获取失败，请检查网络设置";
							comments.comments.push(errorTips);
							return;
						} else if (data.data == null) {
							/* 数据为空*/
							errorTips.content = "未获取到数据";
							comments.comments.push(errorTips);
							return;
						}
						
						var coms = data.data;
						comments.comments.push(coms);
					})
				}
			}
		})
		comments.getComments();
	</script>
</html>
